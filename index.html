<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GlobalCovfefe: GlobalCovfefe -- Emulation of a GlobalCache networked IR device</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GlobalCovfefe
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classGlobalCovfefe.html" title="This class emulates the IR sending of a GlobalCache device. ">GlobalCovfefe</a> -- Emulation of a GlobalCache networked IR device </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The present program/library emulates a TCP commands of a <a href="https://www.globalcache.com">GlobalCaché</a> networked IR sender, like the <a href="https://www.globalcache.com/products/flex/">Flex</a>. The emulation is not complete. The device emulated has one IR sender, and optionally a learner. Sensor inputs and relay closures are planned, but not yet implemented.</p>
<p>Hardware requirements are a "sufficiently large" Arduino with a supported Ethernet shield. The program has been developed on an Arduino Mega 2560 with an Ethernet shield from the first generation (with W5100 chip). It is believed, that, possibly after some stripping, it should run on an Uno-class board. However, this has not yet been verified.</p>
<p>The program/library is built on top of my IR library <a href="https://github.com/bengtmartensson/Infrared4Arduino">Infrared4Arduino</a>. Optionally, the <a href="https://github.com/bengtmartensson/ABeacon">ABeacon</a> library is used to advertise the device on the local network. Other that that, only official Arduino libraries are used.</p>
<p>The TCP API is described <a href="https://www.globalcache.com/files/releases/flex-16/API-Flex_TCP_1.6.pdf">here</a>.</p>
<p>The program/library was written from scratch by myself. It is licensed under the GNU Public License version 2 or later.</p>
<h2>Software architecture</h2>
<p>There is a class <code><a class="el" href="classGlobalCovfefe.html" title="This class emulates the IR sending of a GlobalCache device. ">GlobalCovfefe</a></code> and a derived class <code><a class="el" href="classGlobalCovfefeLearner.html" title="This class is derived from GlobalCovfefe, and adds the get_IRL command, invoking a learner...">GlobalCovfefeLearner</a></code> contained in the <code>src</code> directory. These classes operates on a <a href="https://www.arduino.cc/reference/en/language/functions/communication/stream/">Stream</a>. This is typically, but not necessarily, an <a href="https://www.arduino.cc/en/Reference/ClientConstructor"><code>EthernetClient</code></a> instance.</p>
<h3>Example <code><a class="el" href="classGlobalCovfefe.html" title="This class emulates the IR sending of a GlobalCache device. ">GlobalCovfefe</a></code></h3>
<p>The "example" <code><a class="el" href="classGlobalCovfefe.html" title="This class emulates the IR sending of a GlobalCache device. ">GlobalCovfefe</a></code> contains the deployment program. It controls the Ethernet connections, and delivers it, as a <code>Stream</code> to an instance of the class <code><a class="el" href="classGlobalCovfefe.html" title="This class emulates the IR sending of a GlobalCache device. ">GlobalCovfefe</a>[Learner]</code>.</p>
<h3>Example SerialCovfefe</h3>
<p>The example <code>SerialCovfefe</code>, however, uses only <code>Serial</code>, and can be used for testing or debugging the library.</p>
<h3>Single-threaded operation</h3>
<p>Most important difference from the GlobalCache devices is that the current program is single-threaded. That is, it accepts one command, executes it, and only when it is finished (or times out), the program listens for new commands. Thereby, commands like <code>stopir</code> are not meaningful, and not implemented.</p>
<h4>Only one concurrent TCP session</h4>
<p>For this reason, only one connection at a time is possible. If one connection is active, the device will not respond to further connection attempts until the first connection is terminated. (This makes a LED indicating open connection () quite useful.)</p>
<h2>Commands implemented</h2>
<ul>
<li><code>getversion</code>: Returns the version of the current program, identical to the version in the library manager.</li>
<li><code>getdevices</code>: Returns the configured devices in a machine parseable way.</li>
<li><code>blink</code>: Blinks the configured LEDs.</li>
<li><code>sendir</code>: sends a (raw) IR command. Compressed commands are not implemented (<a href="https://github.com/bengtmartensson/GlobalCovfefe/issues/7">but planned</a>).</li>
<li><code>get_IRL</code>: reads an IR signal and returns it (Only if a learner has been configured.)</li>
</ul>
<p>Expected responses are produced. Error handling and sensibility checking of the provided arguments are essentially non-existent.</p>
<h2>Differences to the GlobalCaché Flex</h2>
<ul>
<li>Only a subset of the TCP commands are implemented.</li>
<li>The HTTP API, including file storage, is not supported.</li>
<li>Only one sender is supported.</li>
<li>Configuration is during compilation only; the GlobalCaché products are higly configurable, for example with an embedded HTTP server.</li>
<li>Only one session, single-threaded. (Thus no commands like <code>stopir</code> would be sensible.)</li>
</ul>
<h2>Dependencies</h2>
<p>The program/library depends on <a href="https://github.com/bengtmartensson/Infrared4Arduino">Infrared4Arduino</a> version 1.0.4 or later, and (optionally) on <a href="https://github.com/bengtmartensson/ABeacon">ABeacon</a>.</p>
<h2>Configuration</h2>
<p>The GlobalCache hardware is extensively configurable, both using the TCP commands, as well as using the built-in HTTP-server. This program is instead configured during compilation, using CPP defines in the file <code>config.h</code>. These are described in that file.</p>
<p>For the configuration of the IrSender and, optionally, the learner, see the documenation of Infrared4Arduino.</p>
<h3>Signaling LEDs</h3>
<p>The library supports up to three LEDs, indicating the present operating mode. These are defined in <code>config.h</code> by assigning pin numbers (denoting pins that make "something" light up when make high) to CPP symobls. This is highly recommended for problem solving and debugging.</p>
<h2>Modules</h2>
<p>GlobalCache devices advertise their configuration with the <code>getdevices</code> command. This is used here too.</p>
<h3>IR module</h3>
<p>An IR module is present as module 1. It has one port.</p>
<h3>IR module as sensor</h3>
<p>Sensor input is <a href="https://github.com/bengtmartensson/GlobalCovfefe/issues/3">planned but not yet implemented</a>.</p>
<h3>Relay module</h3>
<p>Relay module is <a href="https://github.com/bengtmartensson/GlobalCovfefe/issues/4">planned but not yet implemented</a>.</p>
<h3>Serial module</h3>
<p>Due to the single-threaded architecture, implementing a serial module, as in the original hardware, is not possible.</p>
<h2>Porting</h2>
<p><a class="el" href="classGlobalCovfefe.html" title="This class emulates the IR sending of a GlobalCache device. ">GlobalCovfefe</a> as such is a portable program, not a program that needs porting. There are no other "dependencies" than a certain resource consumption. Resources are allocated only indirectly. through the used libraries. However, Infrared4Arduino (which is the low-level library that this one builds upon) only runs on some hardware, and does allocate some resources like timers and interrupts. Porting it it to more hardware platforms is desirable and planned. Help is solicited.</p>
<h2>API documentation</h2>
<p>API documentation for the classes in the library are generated by <a href="http://www.doxygen.org">Doxygen</a>. This available online <a href="https://bengtmartensson.github.io/GlobalCovfefe/">here</a>. The "application" in the example is not documented in this way.</p>
<h2>Use with IrScrutinizer</h2>
<p>Unfortunately, the restriction of only one session can cause somewhat unexpected behavior in <a href="https://github.com/bengtmartensson/harctoolbox">IrScrutinizer</a>. If opened for sending (using the "Sending hw" pane), the connection has to be closed before opening for capturing (the "Capturing hw" pane) &ndash; and similarly for going from capturing to transmitting. Unfortunately, in the present IrScrutinizer there is no possibility to force a GlobalCache connection to close, except for opening a connection with another GlobalCache device, which is of course not possible if only one is present... (<a href="https://github.com/bengtmartensson/harctoolboxbundle/issues/246">IrScrutinizer issue</a>) Workaround: reset the Arduino to close the connection.</p>
<h2>Support and feedback</h2>
<p>Bug reports, improvements requests etc. are solicited and can be directed to <a href="https://github.com/bengtmartensson/GlobalCovfefe/issues">GitHub issues</a>. General discussion etc can be directed to the <a href="https://forum.arduino.cc/index.php?board=16.0">Arduino Home Automation section and Networked Objects</a> forum. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 19 2018 13:41:34 for GlobalCovfefe by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
